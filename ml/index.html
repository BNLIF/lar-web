<!DOCTYPE html>
<html lang="en">

<head>

    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">

    <title>Machine Learning with Wire-Cell</title>

    <!-- Bootstrap Core CSS -->
    <link href="../home/css/bootstrap.min.css" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="../home/css/landing-page.css" rel="stylesheet">
    <style>
      .intro-header {
          padding-top: 50px;
          padding-bottom: 50px;
          text-align: center;
          color: #f8f8f8;
          background: url(./img/banner-web.jpg) no-repeat center center;
          /* https://pixabay.com/illustrations/web-network-information-technology-4869856/ */
          background-size: cover;
          background-color: black;
/*          background-color: rgba(238, 238, 238, 0.1);
          background-blend-mode: color;*/
      }
      .intro-message {
          position: relative;
          padding-top: 10%;
          padding-bottom: 10%;
      }

      .intro-message > h1 {
          margin: 0;
          text-shadow: 2px 2px 3px rgba(0,0,0,0.6);
          font-size: 5em;
      }

    .frosted-glass {
        position: relative;
        height: 100%;
        width: 100%;
        text-align: center;
        box-shadow: 0 0 1rem 0 rgba(0, 0, 0, .2);   
        border-radius: 5px;
        background-color: rgba(255, 255, 255, .15);
        backdrop-filter: blur(4px);
    }

   .frosted-glass2 {
        position: relative;
        /* left: 10%;
        top: 10%;
        height: 80%;
        width: 80%; */
        height: 100%;
        width: 100%;
        text-align: center;
        box-shadow: 0 0 1rem 0 rgba(0, 0, 0, .2);   
        border-radius: 5px;
        position: relative;
        z-index: 1;
        background: inherit;
        overflow: hidden;
    }

    .frosted-glass2:before {
        content: "";
        position: absolute;
        background: inherit;
        z-index: -1;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        box-shadow: inset 0 0 2000px rgba(255, 255, 255, .5);
        filter: blur(3px);
        margin: -20px;
    }

    </style>
    <!-- Custom Fonts -->
    <link href="../home/font-awesome/css/font-awesome.min.css" rel="stylesheet" type="text/css">
    <link href="https://fonts.googleapis.com/css?family=Lato:300,400,700,300italic,400italic,700italic" rel="stylesheet" type="text/css">

    <!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
        <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->

</head>

<body>

    <!-- Navigation -->

    <nav class="navbar navbar-default navbar-fixed-top topnav" role="navigation">
        <div class="container topnav">

            <div class="navbar-header">
                <button type="button" class="navbar-toggle" data-toggle="collapse" data-target="#bs-example-navbar-collapse-1">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand topnav" href="../">LAr@BNL</a>
            </div>

            <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
                <ul class="nav navbar-nav navbar-right">
                    <li>
                        <a href="#top">Top</a>
                    </li>
                    <li>
                        <a href="#intro">Intro</a>
                    </li>
                    <li>
                        <a href="#dnn-sp">DNN-SP</a>
                    </li>
                    <li>
                        <a href="#dnn-vertex">DNN-Vertex</a>
                    </li>
                    <li>
                        <a href="#bdt">BDT</a>
                    </li>
                    <li>
                        <a href="#zio">ZIO</a>
                    </li>
                </ul>
            </div>
        </div>
    </nav>


    <!-- Header -->
    <div class="intro-header"> <a name="Top"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <div class="frosted-glass">
                        <div class="intro-message">
                            <h1>Machine Learning with Wire-Cell</h1>
                            <!-- <h2>Machine Learning with Domain Knowledge for LArTCP</h2> -->
                            <!-- <h3>Simulation, Signal Processing, Reconstruction and Visualization</h3> -->
                            <hr class="intro-divider">
                            <ul class="list-inline intro-social-buttons">
                                <li><div class="btn-group">
                                  <button type="button" class="btn btn-default btn-lg dropdown-toggle" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                    <i class="fa fa-github fa-fw"></i> <span class="network-name">GitHub</span>
                                    <span class="caret"></span>
                                  </button>
                                  <ul class="dropdown-menu" aria-labelledby="dropdownMenu1">
                                    <li><a href="https://github.com/wirecell/">Toolkit (WCT)</a></li>
                                    <li><a href="https://github.com/BNLIF/wire-cell">Prototype (WCP)</a></li>
                                    <li><a href="https://brettviren.github.io/zio/">ZIO</a></li>
                                    <li role="separator" class="divider"></li>
                                    <li><a href="https://github.com/HaiwangYu/Pytorch-UNet">DNN-SP</a></li>
                                    <li><a href="https://github.com/HaiwangYu/nue-cc">DNN-Vertex</a></li>
                                  </ul>
                            </ul>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <!-- /.intro-header -->

    <!-- Page Content -->

     <div class="content-section-a"> <a name="intro"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-12 col-sm-12">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Machine Learning with Wire-Cell</h2>
                    <p class="lead">
		      The Wire-Cell team is actively and judiciously incorporating machine learning techniques into the Wire-Cell event reconstruction paradigm
		      to pursue better physics performance in LArTPC experiments. The stringent requirements of scientific research
		      commonly demand thorough understanding of detector performance and data analysis methods. Therefore, we view
		      machine learning not only as an advanced technique to be incorporated, but also a process to go through in Wire-Cell.
		      Built upon the solid domain knowledge of LArTPC as well as the extensive experience gained in developing Wire-Cell event
		      reconstruction and performing data analysis in LArTPC experiments, we identified several areas (TPC signal processing,
		      neutrino vertex identification, and electron neutrino flavor identification) in which the incorporation
		      of machine learning techniques led to immediate and significant impacts. 
                    </p>
                </div>
<!--                 <div class="col-lg-5 col-lg-offset-2 col-sm-6">
                    <img class="img-responsive" src="../home/img/ipad.png" alt="">
                </div> -->
            </div>

        </div>
    </div>

    <div class="content-section-b"> <a name="dnn-sp"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-5 col-sm-6">
                    <img class="img-responsive" src="./img/dnn-sp-net.png" alt="">
                    <p style="text-align:left">Fig. 1 workflow of the DNN signal processing algorithm.</p>
                    <hr>
                    <img class="img-responsive" src="./img/dnn-sp-disp.png" alt="">
                    <p style="text-align:left">Fig. 2 event displays comparing 3 signal processing algorithms.</p>
                </div>
                <div class="col-lg-5 col-sm-6">
                </div>
                <div class="col-lg-6 col-lg-offset-1 col-sm-6">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Augmented LArTPC Signal Processing with Deep Neural Network</h2>
                    <p class="lead">
                      The Liquid Argon Time Projection Chamber (LArTPC) is an advanced neutrino detector technology widely used in recent
		      and upcoming accelerator neutrino experiments. It features a low energy threshold and high spatial resolution that
		      allow for comprehensive reconstruction of event topology. In current-generation LArTPCs, the recorded data consist
		      of digitized waveforms on wires produced by induced signal of drifting ionization electrons, which can also be viewed
		      as two-dimensional (2D) (time versus wire) projection images of charged-particle trajectories. For such an imaging
		      detector, one critical step is the signal processing that reconstructs the original charge projections from the
		      recorded 2D images. Refer to <a href="https://arxiv.org/abs/1802.08709"> this article </a> for more on LArTCP signal
		      processing.
                    </p>
                    <p class="lead">
                      We introduce a deep neural network (DNN) in LArTPC signal processing to improve the signal region
		      of interest (ROI) detection. By combining domain knowledge (e.g., matching information from multiple wire planes) and
		      deep learning, this method shows significant improvements over traditional methods. Fig. 1 shows the
		      workflow of this algorithm. We used <a href="https://arxiv.org/abs/1505.04597">U-Net</a> as the network structure. We
		      engineered the input single channel 2D image into 3 channels, one processed with filtered deconvolution, two with geometry
		      information baked in. The bottom on the left shows several ROI detection event displays comparing 3 algorithms,
		      traditional algorithm as reference, DNN without geometry information and DNN with geometry information. We can see the
		      DNN with geometry information yields the best results. The inferencing utilities are available in
		      <a href="https://github.com/wirecell/">Wire-Cell Toolkit</a>. Refer to <a href="https://arxiv.org/abs/2007.12743"> this article
		      </a> for more on the DNN LArTCP signal processing.
                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section-a"> <a name="dnn-vertex"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-4 col-sm-4">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Neutrino Vertex Identification with 3D Sparse DNN</h2>
                    <p class="lead">
                      Accurate identification of the primary neutrino-interaction vertex in LArTPCs is critical for the neutrino flavor identification
		      in the charge-current interactions, which is one of the keys to measure the muon neutrino to electron neutrino oscillations.
		      This task is challenging for traditional heuristic logic type algorithms ("Human Learning") because of the wide variety and
		      complexity of neutrino interactions.
                    </p>
                    <p class="lead">
                      This neutrino vertex identification problem can be viewed as a special case of the object detection task in computer vision:
		      region proposal. We utilized a novel regressional segmentation network to predict the distance map of each Wire-Cell 3D space
		      point to the neutrino vertex with <a href="https://github.com/facebookresearch/SparseConvNet">SparseConvNet</a>.
		      While the regressional segmentation network increases the training efficiency, the SparseConvNet makes the training and
		      inferencing much faster and more scalable. The DNN neutrino vertex identification leads to a 30% increase in the electron
		      neutrino identification efficiency with Wire-Cell in MicroBooNE.
		      The inferencing utilities are available in the <a href="https://github.com/BNLIF/wire-cell">Wire-Cell Prototype</a>.		      
                    </p>
                </div>
                <div class="col-lg-7 col-lg-offset-1 col-sm-7">
                    <img class="img-responsive" src="./img/dnn-vertex-demo.png" alt="">
                    <p style="text-align:left">Fig. 1 illustration of the neutrino vertex identification from 3D points.</p>
                    <hr>
                    <img class="img-responsive" src="./img/dnn-vertex-nuecc-disp.png" alt="">
                    <p style="text-align:left">Fig. 2 <a href="https://www.phy.bnl.gov/twister/bee/set/a7bf9060-d6bd-4172-b9c0-b0604daa28e9/event/0/">Bee event display</a> demonstrating with improved vertex identification using DNN, the connected physics object are better segmented.</p>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section-b"> <a name="bdt"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-5 col-lg-offset-1 col-sm-6">
                    <img class="img-responsive" src="./img/bdt-demo.png" alt="">
                    <p style="text-align:left">Fig. 1 illustration of the boosted decision trees.</p>
                    <hr>
                    <img class="img-responsive" src="./img/bdt-perf.png" alt="">
                    <p style="text-align:left">Fig. 2 Background rejection vs. signal efficiency using three algorithms: 1) traditional box cut; 2) BDT from ROOT TMVA; 3) BDT from XGBoost.</p>
                </div>
                <div class="col-lg-6 col-sm-6">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">Electron Neutrino Identification with Boosted Decision Trees</h2>
                    <p class="lead">
                        In MicroBooNE, the original neutrino-to-cosmic ratio is about 1:20k, and only about 0.5% neutrino interactions originate from electron (anti-)neutrinos. A high-performance neutrino flavor identification, e.g. electron neutrino identification, plays an important role in probing the existence of sterile neutrinos in short-baseline neutrino experiments.
                    </p>
                    <p class="lead">
                        Based on “human learning” algorithms, hundreds of kinematic, topological, and calorimetric variables are developed and derived to separate different flavors of neutrino events, while the performance is unstable since the optimization of the cuts on hundreds of variables is fairly inefficient using “human learning” method, e.g. hand-scanning. In order to rapidly and robustly “learn” the features (input variables) of these final state particles from different flavors of neutrino interactions and cosmic-ray muons, the machine learning method – <a href="https://en.wikipedia.org/wiki/Gradient_boosting">boosted decision trees (BDT)</a> – are utilized to take a set of the input features and split input data recursively based on these features. BDT is a much more robust method combining many weak learners (trees) into a strong classifier by maximizing the information gain on a training sample. The neutrino flavor identification is a typical classification problem of BDT. Fig. 2 shows a comparison of the ROC curves from various implemented BDTs in Wire-Cell with the original cut-based (box cut from “human learning”) result. The “Sig Efficiency” is for good reconstructed electron neutrino charged-current events, and “bkg rejection” is for all the other background from neutral-current interactions, muon neutrino charged-current interactions, and cosmic-ray muons. It is obvious the BDT introduces a significant reduction of background events. With <a href="https://xgboost.readthedocs.io/en/latest/">XGBoost (eXtreme Gradient Boosting)</a>, the BDT achieves a 99.9% background rejection rate which corresponds to a 30-fold reduction compared to the cut-based result. This enables a state-of-art electron neutrino identification in MicroBooNE with a purity of about 80%.

                    </p>
                </div>
            </div>
        </div>
    </div>

    <div class="content-section-a"> <a name="zio"></a>
        <div class="container">
            <div class="row">
                <div class="col-lg-6 col-sm-6">
                    <hr class="section-heading-spacer">
                    <div class="clearfix"></div>
                    <h2 class="section-heading">WireCell with ZIO: framework for distributed heterogeneous computing</h2>
                    <p class="lead">
                      The application of machine-learned inference is sped up by two orders of magnitude when run on GPU compared to CPU.  Other computationally intensive algorithms in Wire-Cell are similarly accelerated with GPU implementations compared to their CPU counterparts.  Yet other intensive Wire-Cell algorithms are resistant to the SIMD parallelization strategy that allows GPUs to be exploited and are best run on CPU.  At the same time, many of the available large-scale computing facilities are providing a heterogeneous mix of hardware (CPU, GPU and other accelerators).  Crucially, when CPU and GPU software work together they require and ideal ratio of CPU and GPU hardware in order to keep all cores working.  The required ratio of CPU and GPU depend on the particular type of processing payload and more globally evolve over time as new software developments are Incorporated.  Current Wire-Cell jobs require order 100 CPU cores in order to provide one GPU with enough work to avoid idling.  A method for running heterogeneous code on heterogeneous hardware that can adapt to the CPU/GPU ratio is needed.  ZIO provides the infrastructure for solving this ratio problem.
                    </p>
                    <p class="lead">
<a href="https://brettviren.github.io/zio/">ZIO</a> brings to offline production processing some of the technology which is more commonly found in distributed software based data acquisition systems (an area that ZIO also supports).  ZIO provides software and network protocols to connect disparate applications and hardware by leveraging the power of the <a href="https://zeromq.org/">ZeroMQ</a> software ecosystem.  Wire-Cell and ZIO components connect Wire-Cell flow graphs to the accelerator hardware over ZeroMQ and in a manner that allows multiple programs running on multiple computers to share one or more GPUs themselves potentially on separate hosts.  A slightly extended version of the ZeroMQ <a href="https://rfc.zeromq.org/spec/7/">Majordomo Protocol</a> called <a href="https://github.com/brettviren/generaldomo">Generaldomo</a> allows for multiple multi-threaded software contexts to connect to a broker while, independently, a number of GPU "worker" applications also connect to provide a particular service.  This pattern is what allows for the hardware CPU/GPU ratio to be tuned to match any potentially desired software CPU/GPU ratio.  If a GPU is too idle, it may be shared among more CPU-bound jobs, GPU-bound jobs may add multiple GPUs or any particular ratio may be achived.
                    </p>
                    <p class="lead">
In this multi-host/process/thread environment, safe access to file resources is critical. 
ZIO provides for this in part with an implementation of the ZeroMQ pattern <a href="https://brettviren.github.io/zio/flow-broker.html">credit based flow control</a>.  It allows high throughput data transfers between contexts in a way that bounds the memory usage of buffers and assures reliable data streaming.  On top of this protocol, ZIO provides a distributed file I/O method allowing multiple threads, processes and computers to share a common file resource.  Initial support for the <a href="https://www.hdfgroup.org/">HDF5</a> file format exists and other file formats popular in the space, such as used by <a href="https://root.cern/">ROOT</a> may be added as needed.
                    </p>
                    <p class="lead">
Finally, as distributed processing consists of multiple processes on multiple computers working together, ZIO provides a means to simplify forming their interconnections.  To do this ZIO uses the ZeroMQ <a href="https://rfc.zeromq.org/spec/36/">ZRE (Zyre)</a> discovery protocol.  It allows one to launch multiple processes which may then "find each other" and connect over the network (or locally via IPC or shared memory queues) based on simple, abstract rules.  This saves the production process manager from having to intricately specify every address and port. 
                    </p>
                </div>
                <div class="col-lg-5 col-lg-offset-1 col-sm-6">
                    <img class="img-responsive" src="./img/zio-big-picture.svg" alt="">
                    <p style="text-align:left">Fig. 1 High-level Wire-Cell/ZIO architecture and integration.</p>
                </div>
            </div>
        </div>
    </div>


    <!-- Footer -->
    <footer>
        <div class="container">
            <div class="row">
                <div class="col-lg-12">
                    <hr class="section-heading-spacer" />
                    <div class="clearfix"></div>
                    <p class="copyright text-muted small">Contact: <a href="https://github.com/haiwangYu/">Haiwang Yu</a>, <a href="http://www.phy.bnl.gov/~bviren/">Brett Viren</a>, <a href="https://github.com/czczc">Chao Zhang</a>, <a href="http://www.phy.bnl.gov/xqian/">Xin Qian</a>   &nbsp;|&nbsp; Copyright &copy; BNL. All Rights Reserved </p>
                </div>
            </div>
        </div>
    </footer>

    <!-- jQuery -->
    <script src="../home/js/jquery.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="../home/js/bootstrap.min.js"></script>

</body>

</html>
